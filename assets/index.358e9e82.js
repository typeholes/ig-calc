var e=Object.defineProperty,t=(t,a,s)=>(((t,a,s)=>{a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s})(t,"symbol"!=typeof a?a+"":a,s),s);import{_ as a,p as s,a as n,s as i,d as r,b as u,c as o,e as l,i as c,o as d,f as h,u as p,g,t as v,n as m,h as f,j as y,r as S,k as b,l as _,F as x,m as N,w as k,v as w,q as V,x as C,y as I,z as M,A as U,K as G,B as A}from"./vendor.825307ee.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const B=function(e){return e.name&&(e.toTex=()=>"\\class{hover varname-"+e.name+"}{"+e.name+"}"),e};function T(e,t,s){a({target:e,title:s,yAxis:{domain:[-1,9]},grid:!0,data:[{fn:t,color:"purple",graphType:"polyline"}],tip:{renderer:function(e,t,a){return t.toString()}}})}const q=s();function j(e,t){q.set(e,t)}function D(e,t,a={},s=Number.MAX_SAFE_INTEGER,i=1){if(e.content)return e.content=D(e.content,t,a,s,i+1),e;if(e.op)return e.args=e.args.map((e=>D(e,t,a,s,i+1))),e;if(e.fn){let d=L.get(e.fn);if(void 0===d||i>s)return e.args=e.args.map((e=>D(e,t,a,s,i))),e;for(var r=n(d.body),u={},o=0;o<d.argNames.length;o++){var l=d.argNames[o],c=e.args[o];u[l]=D(c,t,{...a},s,i+1)}return D(r,t,{...a,...u},s,i+1)}if(e.name){const t=a[e.name]||q.get(e.name);if(void 0===t)try{const t=e.evaluate();return"number"==typeof t?n(t.toString()):e}catch(d){return e}return"object"==typeof t?t:n(t)}return e.value?e:void 0}function F(e,t,a,s={}){return function(){let r=n(e),u=t?D(r,a,s):r;return i(u).transform(B).toTex({parenthesis:"keep",implicit:"hide"})}}function E(e,t,a={}){return function(){return function(e,t,a={}){var s=D(e,!0,a);return r(s,t)}(e,t,a).transform(B).toTex({parenthesis:"keep",implicit:"hide"})}}function O(e,t="",a="",s={}){void 0!==t&&""!==t&&function(e,t,a="",s={}){!function(e){const t=e.map((e=>{var t=document.getElementById(e.id),a=e.toTex();return MathJax.tex2chtmlPromise(a,{em:64,ex:16,display:!1,scale:2}).then((e=>{t&&(t.innerHTML="",t.appendChild(e))}))}));MathJax.typesetClear(),Promise.all(t).then(MathJax.typesetPromise()).then(createHovers)}([{id:a+"pretty",toTex:F(e,!1,!1)},{id:a+"pretty-val",toTex:F(e,!0,!1,s)},{id:a+"derivative",toTex:E(e,t)},{id:a+"derivative-val",toTex:E(e,t,s)}])}(e.body,"x",t,s);const i=e.body,r=D(n(i),!0,s),u=r.filter((function(e){return e.isSymbolNode&&void 0!==q.get(e.name)})),o=u.map((e=>e.name)).filter(((e,t,a)=>a.indexOf(e)===t));if(o.length>1)throw"too many free variables in "+e.name+": "+o.join(", ");const l=o[0];T(a,("x"===l?"":l+"=x;")+r.toString(),l)}class z{constructor(e,a,s){t(this,"name"),t(this,"argNames"),t(this,"body"),t(this,"_fn"),this.name=e,this.argNames=a,this.body=s,this._fn=function(e){var t="Valid",a=null;try{a=q.evaluate(e)}catch(s){t=s}return{result:t,fn:a}}(this.defString()).fn}evalArgValues(e){return this.argNames.map((t=>function(e){var t="Not Run";try{t=q.evaluate(e)}catch(a){t=a}return t}(e[t])))}argValues(e){return this.argNames.map((t=>e[t]))}defString(){return this.name+"("+this.argNames.join(",")+") = "+this.body}run(e){return this._fn(...this.evalArgValues(e))}callStr(e){return this.name+"("+this.argValues(e).join(",")+")"}callStrEvaluatedArgs(e){return this.name+"("+this.evalArgValues(e).join(",")+")"}}const J=class{constructor(){t(this,"map",{})}static add(e){J._instance.map[e.name]=e}static get(e){return J._instance.map[e]}static create(e,t,a){const s=new z(e,t,a);return J.add(s),s}static adjust(e,t,a){return this.create(t,e.argNames,a(e.body))}};let L=J;t(L,"_instance",new J);class P{constructor(e,a,s,n,i){t(this,"name"),t(this,"displayName"),t(this,"visible"),t(this,"fn"),t(this,"args"),this.name=e,this.displayName=a,this.visible=s,this.fn=n,this.args=i}get value(){return this.fn.run(this.args)}dependsOn(e){return!(void 0===Object.values(this.args).find((t=>"string"==typeof t&&t.split(/[^a-zA-Z]/).includes(e))))}}const Z=class extends P{constructor(){super("t","Time",!1,null,{}),t(this,"time",0)}get value(){return this.time}};let H=Z;t(H,"instance",new Z);class K extends P{}class R extends P{constructor(e,a,s,n,i,r){super(e,a,s,n,i),t(this,"_cntBought",0),t(this,"_totalBought",0),t(this,"currency"),this.currency=r}forceSetCounts(e,t){this._cntBought=e,this._totalBought=t}get cost(){return super.value}get value(){return this._cntBought}get totalBought(){return this._totalBought}buy(){this._cntBought++,this._totalBought++}spend(e){this._cntBought-=e}}class W{constructor(e,a,s,n,i,r){t(this,"uiState"),t(this,"varAdder"),t(this,"costGetter"),t(this,"costSetter"),t(this,"valueGetter"),t(this,"valueSetter"),t(this,"_items",{t:H.instance}),t(this,"_order",[]),t(this,"_dependencies",{}),t(this,"_dirty",[]),this.uiState=e,this.varAdder=a,this.costGetter=s,this.costSetter=n,this.valueGetter=i,this.valueSetter=r,this.add(H.instance)}getUIValue(e){return this.valueGetter(this.uiState,e.name)}setUIValue(e,t="clean"){const a=e.value,s=e.name;this.valueSetter(this.uiState,s,a),j(s,a),e instanceof R&&(this.valueSetter(this.uiState,e.name+"_total",e.totalBought),j(s+"_total",e.totalBought)),"dirty"===t&&this._dirty.push(s)}getUICost(e){return this.costGetter(this.uiState,e.name)}setUICost(e){e instanceof R&&this.costSetter(this.uiState,e.name,e.cost)}newCalculation(e,t,a,s,n){const i=new K(e,t,a,s,n);return this.add(i),i}newBuyable(e,t,a,s,n,i){this.varAdder(this.uiState,e+"_total");const r=new R(e,t,a,s,n,i);this.add(r),this.setUIValue(r),this.setUICost(r);const u=this._items[i];return u instanceof K&&(u.fn=L.adjust(u.fn,e+"_"+i,(t=>t+" - "+s.callStr(n).replace(e,e+"_total")+" + "+s.callStrEvaluatedArgs(n)))),this.setUIValue(u,"dirty"),r}add(e){this.varAdder(this.uiState,e.name),this._dependencies[e.name]=[],this._calculateDependencies(e),this._order.push(e.name),this._items[e.name]=e,this.setUIValue(e,"dirty")}get(e){return this._items[e]}getNames(){return[...this._order]}_calculateDependencies(e){for(const t in this._items)e.dependsOn(t)&&this._dependencies[t].push(e.name)}tick(e){const t=this._items.t;t.time+=e,this.valueSetter(this.uiState,"t",t.time),this._dirty.push("t"),this._order.forEach((e=>{if(this._dirty.includes(e)){const t=this._items[e];this.setUIValue(t),function(e,t){const a=e.indexOf(t);-1!==a&&e.splice(a,1)}(this._dirty,e),this._dirty.push(...this._dependencies[e])}}))}isBuyable(e){return this.get(e)instanceof R}getCurrency(e){const t=this.get(e);if(t instanceof R)return this.get(t.currency)}getCurrencyName(e){const t=this.getCurrency(e);return t?t.name:""}buy(e){const t=this.get(e);if(!(t instanceof R))return;const a=this.getCurrencyName(e),s=this.get(a),n=t.cost;n>this.valueGetter(this.uiState,a)||(t.buy(),this.setUIValue(s,"dirty"),this.setUIValue(t,"dirty"),this.setUICost(t),s instanceof R&&(s.spend(n),this.setUIValue(s),this.setUICost(s)),this._dirty.push(e))}setFromUIValues(){this._order.forEach((e=>{const t=this._items[e];t instanceof R?t.forceSetCounts(this.valueGetter(this.uiState,e),this.valueGetter(this.uiState,e+"_total")):t instanceof H&&(t.time=this.valueGetter(this.uiState,e)),this._dirty.push(e),j(e,this.valueGetter(this.uiState,e))}))}}class X{constructor(e){t(this,"saves",{}),t(this,"uiStateGetter"),this.uiStateGetter=e;const a=window.localStorage.getItem("matholeSaves");a?this.parseSaveStr(a):this.save("default")}save(e){this.buildNewSave(e),this.writeSaves()}load(e){return this.saves[e]}readSave(e){return!1}parseSaveStr(e){this.saves=JSON.parse(e)}writeSaves(){const e=JSON.stringify(this.saves);window.localStorage.setItem("matholeSaves",e)}buildNewSave(e){this.saves[e]=this.uiStateGetter()}}const $=class{constructor(e,a,s,n,i,r,u,o){t(this,"canTick",!0),t(this,"gameVarManager"),t(this,"saveManager"),t(this,"uiState"),t(this,"cloner"),t(this,"costGetter"),t(this,"valueGetter"),t(this,"costSetter"),t(this,"valueSetter"),this.uiState=e,this.cloner=a,this.costGetter=n,this.valueGetter=r,this.costSetter=i,this.valueSetter=u,this.gameVarManager=new W(e,s,n,i,r,u);o(this.gameVarManager,L),this.saveManager=new X((()=>this.cloner(this.uiState)))}static init(e,t,a,s,n,i,r,u){return $._instance=new $(e,t,a,s,n,i,r,u),e}static getInstance(){return $._instance}displayFunction(e,t){const a=this.gameVarManager.get(e);O(a.fn,"",t,a.args)}getCost(e){return this.costGetter(this.uiState,e)}getValue(e){return this.valueGetter(this.uiState,e)}getNames(){return this.gameVarManager.getNames()}tick(e){this.canTick&&(this.canTick=!1,this.gameVarManager&&this.gameVarManager.tick(e),this.canTick=!0)}getDisplayName(e){return this.gameVarManager.get(e).displayName}isVisible(e){return this.gameVarManager.get(e).visible}buy(e){this.gameVarManager.buy(e)}isBuyable(e){return this.gameVarManager.isBuyable(e)}getCurrencyName(e){return this.gameVarManager.getCurrencyName(e)}getCurrencyDisplayName(e){return this.getDisplayName(this.getCurrencyName(e))}save(){this.canTick=!1,this.saveManager.save("default"),this.canTick=!0}load(){this.canTick=!1;const e=this.saveManager.load("default");for(const t in e){const a=e[t].value,s=e[t].cost;this.valueSetter(this.uiState,t,a),this.costSetter(this.uiState,t,s)}this.gameVarManager.setFromUIValues(),this.canTick=!0}};let Q=$;t(Q,"_instance"),u("data-v-09900752");const Y={key:0},ee=["disabled"],te=f(),ae=g("br",null,null,-1);o();var se=l({props:{varName:{type:String,required:!0,default:""},forceVisible:{type:Boolean,required:!0,default:!1},dependencies:{type:Array,required:!0,default:()=>[]},dependents:{type:Array,required:!0,default:()=>[]},graphed:{type:String,required:!0,default:""}},emits:["update:dependencies","update:graphed","update:dependents"],setup(e,{emit:t}){const a=c("clickActions")(),s=Q.getInstance();function n(e){const t=s.getValue(e);return Math.round(100*t)/100}function i(e){const t=s.getCost(e);return Math.round(100*t)/100}function r(e){const t=s.getCurrencyName(e);if(!t)return!1;return s.getValue(t)>=i(e)}function u(e,t,s){let n={dependent:!1,depends:!1};return a.dependents&&t.includes(e)&&(n.dependent=!0),a.dependencies&&s.includes(e)&&(n.depends=!0),n}return(o,l)=>(d(),h("div",null,[e.forceVisible||p(s).isVisible(e.varName)?(d(),h("div",Y,[g("span",{class:m(u(e.varName,e.dependencies,e.dependents)),onClick:l[0]||(l[0]=n=>function(e){let n="marketScale"===e?["marketValue","stability"]:["stability"];t("update:dependencies","stability"===e?["marketValue","stability"]:["marketScale"]),t("update:dependents",n),t("update:graphed",e),a.graph&&s.displayFunction(e,"#test-graph-expr")}(e.varName))},v(p(s).getDisplayName(e.varName))+": ",3),f(" "+v(n(e.varName))+" ",1),p(s).isBuyable(e.varName)?(d(),h("button",{key:0,onClick:l[1]||(l[1]=t=>{return a=e.varName,n=e.graphed,s.buy(a),void(""!==n&&s.displayFunction(n,"#test-graph-expr"));var a,n}),disabled:!r(e.varName)}," Cost: "+v(i(e.varName))+" "+v(p(s).getCurrencyDisplayName(e.varName)),9,ee)):y("",!0),te,ae])):y("",!0)]))}});se.__scopeId="data-v-09900752",u("data-v-36aede9d");const ne=g("div",{id:"test-graph-expr",class:"graphDiv"},null,-1);o();var ie=l({setup(e){const t=Q.getInstance();let a=S([]),s=S([]),n=S("");return(e,i)=>(d(),h("div",null,[g("h1",null,[b(se,{varName:"score",dependencies:p(a),"onUpdate:dependencies":i[0]||(i[0]=e=>_(a)?a.value=e:a=e),dependents:p(s),"onUpdate:dependents":i[1]||(i[1]=e=>_(s)?s.value=e:s=e),forceVisible:"",graphed:p(n),"onUpdate:graphed":i[2]||(i[2]=e=>_(n)?n.value=e:n=e)},null,8,["dependencies","dependents","graphed"])]),(d(!0),h(x,null,N(p(t).getNames(),(e=>(d(),h("div",null,[b(se,{varName:e,dependencies:p(a),"onUpdate:dependencies":i[3]||(i[3]=e=>_(a)?a.value=e:a=e),dependents:p(s),"onUpdate:dependents":i[4]||(i[4]=e=>_(s)?s.value=e:s=e),graphed:p(n),"onUpdate:graphed":i[5]||(i[5]=e=>_(n)?n.value=e:n=e)},null,8,["varName","dependencies","dependents","graphed"])])))),256)),ne]))}});ie.__scopeId="data-v-36aede9d",u("data-v-fad43050");const re=f(" function: "),ue=g("br",null,null,-1),oe=g("br",null,null,-1),le=g("div",{id:"view-fn-graph-expr",class:"graphDiv"},null,-1);o();var ce=l({setup(e){let t=S("x"),a=S("x");function s(){let e=n(t.value);T("#view-fn-graph-expr",D(e,!0,{}).toString(),"0"),a.value=D(e,!0,{},1).toString()}function i(){t.value=a.value,s()}return(e,n)=>(d(),h("div",null,[re,k(g("input",{"onUpdate:modelValue":n[0]||(n[0]=e=>_(t)?t.value=e:t=e),onChange:s,size:"50"},null,544),[[w,p(t)]]),ue,f(" expanded: "+v(p(a))+" ",1),oe,g("button",{onClick:i},"replace with expanded"),le]))}});ce.__scopeId="data-v-fad43050";const de={setup:e=>(e,t)=>null};function he(e,t){t.create("id",["x"],"x");const a=t.create("times",["x","b"],"x*b");t.create("reciprical",["x"],"1/(x+1)"),t.create("zigZag",["x"],"1-2 * acos((1- smoother) * sin(2 * pi * x))/pi"),t.create("squareWave",["x"],"2 * atan( sin(2 * pi * x)/ smoother )/pi"),t.create("sawtooth",["x"],"(1+zigZag((2 * x - 1)/4) * squareWave(x/2))/2"),t.create("steps",["x"],"x - sawtooth(x)"),t.create("logSquares",["x","b"],"log(x^2+b^2)"),t.create("curvedSawtooth",["x"],"logSquares(x^smoother,sawtooth(x))");const s=t.create("calcMarketValue",["x"],"curvedSawtooth(x)*(marketScale+1)");e.newCalculation("score","Score",!1,a,{x:"t",b:2}),e.newBuyable("stability","Market Stability",!0,a,{x:1.25,b:"stability+1"},"score"),e.newBuyable("marketScale","Market Scale",!0,a,{x:2,b:"marketScale+1"},"stability"),e.newCalculation("smoother","Smoother",!1,a,{x:"stability",b:.01}),e.newCalculation("marketValue","Market Value",!0,s,{x:"t"})}de.__scopeId="data-v-06a44740";var pe=l({props:{label:{type:String,required:!0},state:{type:Boolean,required:!0}},emits:["update:state"],setup:(e,{emit:t})=>(t,a)=>(d(),h("button",{class:m({toggled:e.state}),onClick:a[0]||(a[0]=a=>t.$emit("update:state",!e.state))},v(e.label),3))});pe.__scopeId="data-v-af584eb2",u("data-v-185c34f8");const ge=f(" todo "),ve={width:"100%",border:"1"},me={rowspan:"3",width:"10%"},fe=f(" Click Actions "),ye=g("tr",null,[g("td")],-1);o();var Se=l({props:{},setup(e){S(Q.init(S({}),(e=>e),((e,t)=>e.value[t]={cost:0,value:0}),((e,t)=>e.value[t].cost),((e,t,a)=>e.value[t].cost=a),((e,t)=>e.value[t].value),((e,t,a)=>e.value[t].value=a),he));const t=Q.getInstance(),a=V(de);function s(e){a.value=e}const n=S(0),i=S({dependencies:!1,dependents:!1,graph:!1,sticky:!1});function r(){if(!i.value.sticky)for(let e in i.value)i.value[e]=!1}C("clickActions",(()=>i.value));let u=0;function o(e){const a=e-u;t.canTick&&a>=500&&(t.tick(a/1e4),u=e,n.value=Math.floor(a)),window.requestAnimationFrame(o)}return I((()=>{console.log("mounted "),window.requestAnimationFrame(o)})),(e,n)=>(d(),h(x,null,[ge,g("table",ve,[g("tr",null,[g("td",null,[g("button",{onClick:n[0]||(n[0]=e=>s(ie))},"Game"),g("button",{onClick:n[1]||(n[1]=(...e)=>p(t).save&&p(t).save(...e))},"save"),g("button",{onClick:n[2]||(n[2]=(...e)=>p(t).load&&p(t).load(...e))},"load"),g("button",{onClick:n[3]||(n[3]=e=>s(ce))},"Function Viewer")]),g("td",me,[fe,b(pe,{label:"Dependencies",state:i.value.dependencies,"onUpdate:state":n[4]||(n[4]=e=>i.value.dependencies=e)},null,8,["state"]),b(pe,{label:"Dependents",state:i.value.dependents,"onUpdate:state":n[5]||(n[5]=e=>i.value.dependents=e)},null,8,["state"]),b(pe,{label:"Graph",state:i.value.graph,"onUpdate:state":n[6]||(n[6]=e=>i.value.graph=e)},null,8,["state"]),b(pe,{label:"Sticky",state:i.value.sticky,"onUpdate:state":n[7]||(n[7]=e=>i.value.sticky=e)},null,8,["state"])])]),g("tr",null,[g("td",{onClick:r},[(d(),M(G,null,[(d(),M(U(p(a))))],1024))])]),ye])],64))}});Se.__scopeId="data-v-185c34f8";const be={setup(e){var t={};return C("appAddViewMap",(function(e,a,s,n=t){n[e]||(n[e]={}),n[e][a]=s})),C("appGetView",(function(e,a,s=t){return s[e][a]})),(e,t)=>(d(),M(Se))}};window.global={},A(be).mount("#app");
