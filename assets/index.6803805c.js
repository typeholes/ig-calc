var e=Object.defineProperty,t=(t,a,n)=>(((t,a,n)=>{a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n})(t,"symbol"!=typeof a?a+"":a,n),n);import{_ as a,p as n,a as s,s as r,d as i,r as l,b as u,i as o,c,e as d,f as h,o as p,g as m,u as g,h as v,t as f,n as y,j as N,k as S,l as b,m as V,F as _,q as x,w,v as k,x as C,y as M,z as U,A as I,B as G,K as A,C as D}from"./vendor.55b2bf50.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const O=function(e){return e.name&&(e.toTex=()=>"\\class{hover varname-"+e.name+"}{"+e.name+"}"),e};function B(e,t,n){a({target:e,title:n,yAxis:{domain:[-1,9]},grid:!0,data:[{fn:t,color:"purple",graphType:"polyline"}],tip:{renderer:function(e,t,a){return t.toString()}}})}function T(e){return e.filter(((e,t,a)=>a.indexOf(e)===t))}const q=n();function E(e,t){q.set(e,t)}function j(e,t,a={},n=Number.MAX_SAFE_INTEGER,r=1){if(e.content)return e.content=j(e.content,t,a,n,r+1),e;if(e.op)return e.args=e.args.map((e=>j(e,t,a,n,r+1))),e;if(e.fn){let d=Z.get(e.fn);if(void 0===d||r>n)return e.args=e.args.map((e=>j(e,t,a,n,r))),e;for(var i=s(d.body),l={},u=0;u<d.argNames.length;u++){var o=d.argNames[u],c=e.args[u];l[o]=j(c,t,{...a},n,r+1)}return j(i,t,{...a,...l},n,r+1)}if(e.name){const n=a[e.name],r=t?n||q.get(e.name):n;if(void 0===r)try{const t=e.evaluate();return"number"==typeof t?s(t.toString()):e}catch(d){return e}return"object"==typeof r?r:s(r)}return e.value?e:void 0}function F(e,t,a,n={}){return function(){let i=s(e),l=t?j(i,a,n):i;return r(l).transform(O).toTex({parenthesis:"keep",implicit:"hide"})}}function z(e,t,a={}){return function(){return function(e,t,a={}){var n=j(e,!0,a);return i(n,t)}(e,t,a).transform(O).toTex({parenthesis:"keep",implicit:"hide"})}}function J(e,t="",a="",n="",r,i={}){void 0!==t&&""!==t&&function(e,t,a="",n={}){!function(e){const t=e.map((e=>{var t=document.getElementById(e.id),a=e.toTex();return MathJax.tex2chtmlPromise(a,{em:64,ex:16,display:!1,scale:2}).then((e=>{t&&(t.innerHTML="",t.appendChild(e))}))}));MathJax.typesetClear(),Promise.all(t).then(MathJax.typesetPromise()).then(createHovers)}([{id:a+"pretty",toTex:F(e,!1,!1)},{id:a+"pretty-val",toTex:F(e,!0,!1,n)},{id:a+"derivative",toTex:z(e,t)},{id:a+"derivative-val",toTex:z(e,t,n)}])}(e.body,"x",t,i);const l=e.body,u=j(s(l),!0,i),o=T(u.filter((function(e){return e.isSymbolNode&&void 0!==q.get(e.name)})).map((e=>e.name)));if(o.length>1)throw"too many free variables in "+e.name+": "+o.join(", ");const c=o[0];B(a,("x"===c?"":c+"=x;")+u.toString(),(r[c]||c)+" -> "+n)}class L{constructor(e,a,n){t(this,"name"),t(this,"argNames"),t(this,"body"),t(this,"_fn"),this.name=e,this.argNames=a,this.body=n,this._fn=function(e){var t="Valid",a=null;try{a=q.evaluate(e)}catch(n){t=n}return{result:t,fn:a}}(this.defString()).fn}evalArgValues(e){return this.argNames.map((t=>function(e){var t="Not Run";try{t=q.evaluate(e)}catch(a){t=a}return t}(e[t])))}argValues(e){return this.argNames.map((t=>e[t]))}defString(){return this.name+"("+this.argNames.join(",")+") = "+this.body}run(e){return this._fn(...this.evalArgValues(e))}callStr(e){return this.name+"("+this.argValues(e).join(",")+")"}callStrEvaluatedArgs(e){return this.name+"("+this.evalArgValues(e).join(",")+")"}}const P=class{constructor(){t(this,"map",{})}static add(e){P._instance.map[e.name]=e}static get(e){return P._instance.map[e]}static create(e,t,a){const n=new L(e,t,a);return P.add(n),n}static adjust(e,t,a){return this.create(t,e.argNames,a(e.body))}};let Z=P;t(Z,"_instance",new P);class H{constructor(e,a,n,s,r){t(this,"name"),t(this,"displayName"),t(this,"visible"),t(this,"fn"),t(this,"args"),this.name=e,this.displayName=a,this.visible=n,this.fn=s,this.args=r}get value(){return this.fn.run(this.args)}dependsOn(e){return!(void 0===Object.values(this.args).find((t=>"string"==typeof t&&t.split(/[^a-zA-Z]/).includes(e))))}}const K=class extends H{constructor(){super("t","Time",!1,null,{}),t(this,"time",0)}get value(){return this.time}};let R=K;t(R,"instance",new K);class W extends H{}class X extends H{constructor(e,a,n,s,r,i){super(e,a,n,s,r),t(this,"_cntBought",0),t(this,"_totalBought",0),t(this,"currency"),this.currency=i}forceSetCounts(e,t){this._cntBought=e,this._totalBought=t}get cost(){return super.value}get value(){return this._cntBought}get totalBought(){return this._totalBought}buy(){this._cntBought++,this._totalBought++}spend(e){this._cntBought-=e}}class ${constructor(e,a,n,s,r,i){t(this,"uiState"),t(this,"varAdder"),t(this,"costGetter"),t(this,"costSetter"),t(this,"valueGetter"),t(this,"valueSetter"),t(this,"_items",{t:R.instance}),t(this,"_order",[]),t(this,"_dependencies",{}),t(this,"_dirty",[]),this.uiState=e,this.varAdder=a,this.costGetter=n,this.costSetter=s,this.valueGetter=r,this.valueSetter=i,this.add(R.instance)}getUIValue(e){return this.valueGetter(this.uiState,e.name)}setUIValue(e,t="clean"){const a=e.value,n=e.name;this.valueSetter(this.uiState,n,a),E(n,a),e instanceof X&&(this.valueSetter(this.uiState,e.name+"_total",e.totalBought),E(n+"_total",e.totalBought)),"dirty"===t&&this._dirty.push(n)}getUICost(e){return this.costGetter(this.uiState,e.name)}setUICost(e){e instanceof X&&this.costSetter(this.uiState,e.name,e.cost)}newCalculation(e,t,a,n,s){const r=new W(e,t,a,n,s);return this.add(r),r}newBuyable(e,t,a,n,s,r){this.varAdder(this.uiState,e+"_total");const i=new X(e,t,a,n,s,r);this.add(i),this.setUIValue(i),this.setUICost(i);const l=this._items[r];return l instanceof W&&(l.fn=Z.adjust(l.fn,e+"_"+r,(t=>t+" - "+n.callStr(s).replace(e,e+"_total")+" + "+n.callStrEvaluatedArgs(s)))),this.setUIValue(l,"dirty"),i}add(e){this.varAdder(this.uiState,e.name),this._dependencies[e.name]=function(e,t){if(!e)return[];const a=e.body;return T(j(s(a),!1,t).filter((function(e){return e.isSymbolNode&&void 0!==q.get(e.name)})).map((e=>e.name)))}(e.fn,e.args),this._order.push(e.name),this._items[e.name]=e,this.setUIValue(e,"dirty")}get(e){return this._items[e]}getNames(){return[...this._order]}tick(e){const t=this._items.t;t.time+=e,this.valueSetter(this.uiState,"t",t.time),this._dirty.push("t"),this._order.forEach((e=>{if(this._dirty.includes(e)){const t=this._items[e];this.setUIValue(t),function(e,t){const a=e.indexOf(t);-1!==a&&e.splice(a,1)}(this._dirty,e),this._dirty.push(...this._dependencies[e])}}))}isBuyable(e){return this.get(e)instanceof X}getDependencies(e){const t=this._dependencies[e]||[],a=t.map((e=>this.getDependencies(e))).flat();return t.push(...a),t}getDependents(e){const t=[];return this._order.forEach((a=>{this._dependencies[a].includes(e)&&t.push(a)})),t}getCurrency(e){const t=this.get(e);if(t instanceof X)return this.get(t.currency)}getCurrencyName(e){const t=this.getCurrency(e);return t?t.name:""}buy(e){const t=this.get(e);if(!(t instanceof X))return;const a=this.getCurrencyName(e),n=this.get(a),s=t.cost;s>this.valueGetter(this.uiState,a)||(t.buy(),this.setUIValue(n,"dirty"),this.setUIValue(t,"dirty"),this.setUICost(t),n instanceof X&&(n.spend(s),this.setUIValue(n),this.setUICost(n)),this._dirty.push(e))}setFromUIValues(){this._order.forEach((e=>{const t=this._items[e];t instanceof X?t.forceSetCounts(this.valueGetter(this.uiState,e),this.valueGetter(this.uiState,e+"_total")):t instanceof R&&(t.time=this.valueGetter(this.uiState,e)),this._dirty.push(e),E(e,this.valueGetter(this.uiState,e))}))}}class Q{constructor(e){t(this,"saves",{}),t(this,"uiStateGetter"),this.uiStateGetter=e;const a=window.localStorage.getItem("matholeSaves");a?this.parseSaveStr(a):this.save("default")}save(e){this.buildNewSave(e),this.writeSaves()}load(e){return this.saves[e]}readSave(e){return!1}parseSaveStr(e){this.saves=JSON.parse(e)}writeSaves(){const e=JSON.stringify(this.saves);window.localStorage.setItem("matholeSaves",e)}buildNewSave(e){this.saves[e]=this.uiStateGetter()}}const Y=class{constructor(e,a,n,s,r,i,l,u){t(this,"canTick",!0),t(this,"gameVarManager"),t(this,"saveManager"),t(this,"uiState"),t(this,"cloner"),t(this,"costGetter"),t(this,"valueGetter"),t(this,"costSetter"),t(this,"valueSetter"),this.uiState=e,this.cloner=a,this.costGetter=s,this.valueGetter=i,this.costSetter=r,this.valueSetter=l,this.gameVarManager=new $(e,n,s,r,i,l);u(this.gameVarManager,Z),this.saveManager=new Q((()=>this.cloner(this.uiState)))}static init(e,t,a,n,s,r,i,l){return Y._instance=new Y(e,t,a,n,s,r,i,l),e}static getInstance(){return Y._instance}displayFunction(e,t,a,n){const s=this.gameVarManager.get(e);J(s.fn,"",t,n,a,s.args)}getNameMap(){const e={};return this.gameVarManager.getNames().forEach((t=>e[t]=this.getDisplayName(t))),e}getCost(e){return this.costGetter(this.uiState,e)}getValue(e){return this.valueGetter(this.uiState,e)}getNames(){return this.gameVarManager.getNames()}tick(e){this.canTick&&(this.canTick=!1,this.gameVarManager&&this.gameVarManager.tick(e),this.canTick=!0)}getDisplayName(e){return this.gameVarManager.get(e).displayName}isVisible(e){return this.gameVarManager.get(e).visible}buy(e){this.gameVarManager.buy(e)}isBuyable(e){return this.gameVarManager.isBuyable(e)}getCurrencyName(e){return this.gameVarManager.getCurrencyName(e)}getCurrencyDisplayName(e){return this.getDisplayName(this.getCurrencyName(e))}getDependencies(e){return this.gameVarManager.getDependencies(e)}getDependents(e){return this.gameVarManager.getDependents(e)}save(){this.canTick=!1,this.saveManager.save("default"),this.canTick=!0}load(){this.canTick=!1;const e=this.saveManager.load("default");for(const t in e){const a=e[t].value,n=e[t].cost;this.valueSetter(this.uiState,t,a),this.costSetter(this.uiState,t,n)}this.gameVarManager.setFromUIValues(),this.canTick=!0}};let ee=Y;var te,ae;function ne(...e){const t={};return e.forEach((e=>t[e]=o(e)())),t}t(ee,"_instance"),(ae=te||(te={})).ClickAction="clickAction",ae.GraphedVarName="graphedVarName",ae.SelectedVarName="selectedVarName",ae.Dependencies="dependencies",ae.Dependents="dependents",ae.ClickActions="clickActions",c("data-v-76d96e3f");const se={key:0},re=["disabled"],ie=N(),le=v("br",null,null,-1);d();var ue=h({props:{varName:{type:String,required:!0},forceVisible:{type:Boolean,required:!0,default:!1}},setup(e){const{clickAction:t,dependencies:a,dependents:n,graphedVarName:s,selectedVarName:r}=ne(te.ClickAction,te.Dependencies,te.Dependents,te.GraphedVarName,te.SelectedVarName),i=ee.getInstance();function l(e){const t=i.getValue(e);return Math.round(100*t)/100}function u(e){const t=i.getCost(e);return Math.round(100*t)/100}function o(e){const t=i.getCurrencyName(e);if(!t)return!1;return i.getValue(t)>=u(e)}function c(e,t,a,n){let s={dependent:!1,depends:!1,hidden:!0,inline:!0};return e===t?(s.hidden=!1,s):(a.includes(e)&&(s.dependent=!0,s.hidden=!1),n.includes(e)&&(s.depends=!0,s.hidden=!1),s)}function d(e){return(i.isBuyable(e)?"Cost of ":"")+i.getDisplayName(e)}return(h,b)=>(p(),m("div",null,[e.forceVisible||g(i).isVisible(e.varName)?(p(),m("div",se,[v("div",{class:y(c(e.varName,g(r),g(a),g(n)))},[v("span",null,f(e.varName===g(r)?"⊜":"⇒"),1)],2),v("span",{onClick:b[0]||(b[0]=l=>function(e){if("select"===t.value){r.value=e;let t=i.getDependencies(e),s=i.getDependents(e);a.value=t,n.value=s}"graph"===t.value&&(s.value=e,i.displayFunction(e,"#test-graph-expr",i.getNameMap(),d(e)))}(e.varName))},f(g(i).getDisplayName(e.varName))+": ",1),N(" "+f(l(e.varName))+" ",1),g(i).isBuyable(e.varName)?(p(),m("button",{key:0,onClick:b[1]||(b[1]=t=>{return a=e.varName,n=g(s),i.buy(a),void(""!==n&&i.displayFunction(n,"#test-graph-expr",i.getNameMap(),d(n)));var a,n}),disabled:!o(e.varName)}," Cost: "+f(u(e.varName))+" "+f(g(i).getCurrencyDisplayName(e.varName)),9,re)):S("",!0),ie,le])):S("",!0)]))}});ue.__scopeId="data-v-76d96e3f",c("data-v-0f62de1e");const oe=v("div",{id:"test-graph-expr",class:"graphDiv"},null,-1);d();var ce=h({setup(e){const t=ee.getInstance(),{dependencies:a,dependents:n,graphedVarName:s,selectedVarName:r}=ne(te.Dependencies,te.Dependents,te.GraphedVarName,te.SelectedVarName);return(e,i)=>(p(),m("div",null,[v("h1",null,[b(ue,{varName:"t",dependencies:g(a),"onUpdate:dependencies":i[0]||(i[0]=e=>V(a)?a.value=e:null),dependents:g(n),"onUpdate:dependents":i[1]||(i[1]=e=>V(n)?n.value=e:null),forceVisible:"",graphedVarName:g(s),"onUpdate:graphedVarName":i[2]||(i[2]=e=>V(s)?s.value=e:null),selectedVarName:g(r),"onUpdate:selectedVarName":i[3]||(i[3]=e=>V(r)?r.value=e:null)},null,8,["dependencies","dependents","graphedVarName","selectedVarName"])]),v("h1",null,[b(ue,{varName:"score",dependencies:g(a),"onUpdate:dependencies":i[4]||(i[4]=e=>V(a)?a.value=e:null),dependents:g(n),"onUpdate:dependents":i[5]||(i[5]=e=>V(n)?n.value=e:null),forceVisible:"",graphedVarName:g(s),"onUpdate:graphedVarName":i[6]||(i[6]=e=>V(s)?s.value=e:null),selectedVarName:g(r),"onUpdate:selectedVarName":i[7]||(i[7]=e=>V(r)?r.value=e:null)},null,8,["dependencies","dependents","graphedVarName","selectedVarName"])]),(p(!0),m(_,null,x(g(t).getNames(),(e=>(p(),m("div",null,[b(ue,{varName:e,dependencies:g(a),"onUpdate:dependencies":i[8]||(i[8]=e=>V(a)?a.value=e:null),dependents:g(n),"onUpdate:dependents":i[9]||(i[9]=e=>V(n)?n.value=e:null),graphedVarName:g(s),"onUpdate:graphedVarName":i[10]||(i[10]=e=>V(s)?s.value=e:null),selectedVarName:g(r),"onUpdate:selectedVarName":i[11]||(i[11]=e=>V(r)?r.value=e:null)},null,8,["varName","dependencies","dependents","graphedVarName","selectedVarName"])])))),256)),oe]))}});ce.__scopeId="data-v-0f62de1e",c("data-v-fad43050");const de=N(" function: "),he=v("br",null,null,-1),pe=v("br",null,null,-1),me=v("div",{id:"view-fn-graph-expr",class:"graphDiv"},null,-1);d();var ge=h({setup(e){let t=l("x"),a=l("x");function n(){let e=s(t.value);B("#view-fn-graph-expr",j(e,!0,{}).toString(),"0"),a.value=j(e,!0,{},1).toString()}function r(){t.value=a.value,n()}return(e,s)=>(p(),m("div",null,[de,w(v("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>V(t)?t.value=e:t=e),onChange:n,size:"50"},null,544),[[k,g(t)]]),he,N(" expanded: "+f(g(a))+" ",1),pe,v("button",{onClick:r},"replace with expanded"),me]))}});function ve(e,t){t.create("id",["x"],"x");const a=t.create("times",["x","b"],"x*b");t.create("reciprical",["x"],"1/(x+1)"),t.create("zigZag",["x"],"1-2 * acos((1- smoother) * sin(2 * pi * x))/pi"),t.create("squareWave",["x"],"2 * atan( sin(2 * pi * x)/ smoother )/pi"),t.create("sawtooth",["x"],"(1+zigZag((2 * x - 1)/4) * squareWave(x/2))/2"),t.create("steps",["x"],"x - sawtooth(x)"),t.create("logSquares",["x","b"],"log(x^2+b^2)"),t.create("curvedSawtooth",["x"],"logSquares(x^smoother,sawtooth(x))");const n=t.create("calcMarketValue",["x"],"curvedSawtooth(x)*(marketScale+1)");e.newCalculation("score","Score",!1,a,{x:"t",b:2}),e.newBuyable("stability","Market Stability",!0,a,{x:1.25,b:"stability+1"},"score"),e.newBuyable("marketScale","Market Scale",!0,a,{x:2,b:"marketScale+1"},"stability"),e.newCalculation("smoother","Smoother",!1,a,{x:"stability",b:.01}),e.newCalculation("marketValue","Market Value",!0,n,{x:"t"})}ge.__scopeId="data-v-fad43050";var fe=h({props:{labelOn:{type:String,required:!0},labelOff:{type:String,required:!0,default:""},colorOn:{type:String,required:!0,default:"#dee7a7"},colorOff:{type:String,required:!0,default:"#dee7a7"},valueOn:{type:null,required:!0,default:!0},valueOff:{type:null,required:!0,default:!1}},emits:["update:value"],setup(e){const t=l(!0);return(a,n)=>(p(),m("button",{style:C({backgroundColor:t.value?e.colorOn:e.colorOff}),onClick:n[0]||(n[0]=n=>{t.value=!t.value,a.$emit("update:value",t.value?e.valueOn:e.valueOff)})},f(t.value?e.labelOn:e.labelOff||e.labelOn),5))}});c("data-v-44b10cd7");const ye=N(" todo "),Ne={width:"100%",border:"1"},Se={rowspan:"3",width:"10%"},be=N(" Click Action "),Ve=v("tr",null,[v("td")],-1);d();var _e=h({setup(e){l(ee.init(l({}),(e=>e),((e,t)=>e.value[t]={cost:0,value:0}),((e,t)=>e.value[t].cost),((e,t,a)=>e.value[t].cost=a),((e,t)=>e.value[t].value),((e,t,a)=>e.value[t].value=a),ve));const t=ee.getInstance(),{clickAction:a,graphedVarName:n,selectedVarName:s,dependencies:r,dependents:i}=function(...e){const t={};return e.forEach((([e,a])=>{const n=l(a);u(e,(()=>n)),t[e]=n})),t}([te.ClickAction,"select"],[te.GraphedVarName,""],[te.SelectedVarName,""],[te.Dependencies,[]],[te.Dependents,[]]),o=M(ce);function c(e){o.value=e}const d=l(0);let h=0;function f(e){const a=e-h;t.canTick&&a>=500&&(t.tick(a/1e4),h=e,d.value=Math.floor(a)),window.requestAnimationFrame(f)}return U((()=>{console.log("mounted "),window.requestAnimationFrame(f)})),(e,r)=>(p(),m(_,null,[ye,v("table",Ne,[v("tr",null,[v("td",null,[v("button",{onClick:r[0]||(r[0]=e=>c(ce))},"Game"),v("button",{onClick:r[1]||(r[1]=(...e)=>g(t).save&&g(t).save(...e))},"save"),v("button",{onClick:r[2]||(r[2]=(...e)=>g(t).load&&g(t).load(...e))},"load"),v("button",{onClick:r[3]||(r[3]=e=>c(ge))},"Function Viewer")]),v("td",Se,[be,b(fe,{labelOn:"Select",labelOff:"Graph",valueOn:"select",valueOff:"graph",value:g(a),"onUpdate:value":r[4]||(r[4]=e=>V(a)?a.value=e:null)},null,8,["value"])])]),v("tr",null,[v("td",null,[(p(),I(A,null,[(p(),I(G(g(o)),{selectedVarName:g(s),"onUpdate:selectedVarName":r[5]||(r[5]=e=>V(s)?s.value=e:null),graphedVarName:g(n),"onUpdate:graphedVarName":r[6]||(r[6]=e=>V(n)?n.value=e:null)},null,8,["selectedVarName","graphedVarName"]))],1024))])]),Ve])],64))}});_e.__scopeId="data-v-44b10cd7";const xe={setup(e){var t={};return u("appAddViewMap",(function(e,a,n,s=t){s[e]||(s[e]={}),s[e][a]=n})),u("appGetView",(function(e,a,n=t){return n[e][a]})),(e,t)=>(p(),I(_e))}};window.global={},D(xe).mount("#app");
