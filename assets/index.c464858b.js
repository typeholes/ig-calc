import{p as e,a as t,d as n,u as r,r as o,o as a,c as l,b as i,e as s,f as c,t as u,g as p,C as d,i as f,h as v,j as m,k as g,l as h,M as x,S as y,m as S,n as w,_ as b,q as C,s as E,v as k,F as O,w as _,x as L,y as N,z as R,A as q,B as j,D as J,E as I,G as U,H as B,I as K}from"./vendor.83178436.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}(),e("data-v-3ea73f38");const M={class:"container"},T={class:"vSplitter"},z={key:0,class:"vLeft"},P={class:"vRight"};t();var $=n({props:{collapsed:{type:Boolean,required:!0,default:!1},leftColSpec:{type:String,required:!1,default:"45%"},rightColSpec:{type:String,required:!1,default:"2fr"}},emits:["update:collapsed"],setup(e,{emit:t}){const n=e;r((e=>({"33a94654":p(d).left.width,"366e43da":n.rightColSpec,"23145d08":p(d).color})));const d=o({color:"rgb(255,255,255)",left:{width:n.leftColSpec,collapsed:n.collapsed,label:"«"}});return(e,r)=>(a(),l("div",M,[i("div",T,[n.collapsed?c("",!0):(a(),l("div",z,[s(e.$slots,"left",{},void 0,!0)])),i("div",{onClick:r[0]||(r[0]=e=>{return r="left",n.collapsed?(d[r].width=n.leftColSpec,d[r].label="«"):(d[r].width="0%",d[r].label="»"),void t("update:collapsed",!n.collapsed);var r}),class:"collapseLeft"},u(p(d).left.label),1),i("div",P,[s(e.$slots,"right",{},void 0,!0)])])]))}});$.__scopeId="data-v-3ea73f38",e("data-v-3090d659");const A={class:"container"},D={class:"vSplitter"},G={class:"vTop"},H={class:"vBottom"},V={key:0};t();var F=n({props:{collapsed:{type:Boolean,required:!0,default:!1},topColSpec:{type:String,required:!1,default:"45%"},bottomColSpec:{type:String,required:!1,default:"2fr"}},emits:["update:collapsed"],setup(e,{emit:t}){const n=e;r((e=>({"1843c624":n.topColSpec,"405d8bce":p(d).bottom.width,"697a065e":p(d).color})));const d=o({color:"rgb(255,255,255)",bottom:{width:n.bottomColSpec,collapsed:n.collapsed}});return(r,o)=>{return a(),l("div",A,[i("div",D,[i("div",G,[s(r.$slots,"top",{},void 0,!0)]),i("div",{onClick:o[0]||(o[0]=e=>{return r="bottom",n.collapsed?d[r].width=n.topColSpec:d[r].width="0%",void t("update:collapsed",!n.collapsed);var r}),class:"collapseTop"},u((p=e.collapsed,p?"»":"«")),1),i("div",H,[n.collapsed?c("",!0):(a(),l("div",V,[s(r.$slots,"bottom",{},void 0,!0)]))])])]);var p}}});function W(e){return null!=e}function Q(e,t){return"object"==typeof e&&W(e)&&Object.hasOwn(e,t)}function X(e,t,n){return Q(e,t)&&n(e[t])}function Y(e){return"boolean"==typeof e}function Z(e){return"string"==typeof e}F.__scopeId="data-v-3090d659";const ee=e=>({_tag:"Left",value:e}),te=e=>({_tag:"Right",value:e}),ne=e=>function(e,t){return Q(e,"_tag")&&e._tag===t}(e,"Left")&&Q(e,"value");function re(e){try{return te(e())}catch(t){return t instanceof Error?ee(t):ee(new Error(String(t)))}}function oe(e,t){return ne(e)?e:te(t(e.value))}function ae(e,t){ne(e)?t.Left(e.value):t.Right(e.value)}function le(e){if(ne(e))throw e.value;return e}const ie={on:ae,map:oe},se=(e,t,n)=>ne(e)?(t(e.value),n):e.value;function ce(e,t,n=0,r=100){if(n>r)return e;if(v(e)){const r=e.fn.name,o=t[r];if(m(o)){return ce(pe(o,e),t,n+1)}}return e.transform((e=>{if(v(e)){const r=e.fn.name,o=t[r];if(m(o)){return ce(pe(o,e),t,n+1)}}if(f(e)){const r=e.name,o=t[r],a=W(o)&&"number"==typeof o?new d(o):o;if(W(a)){return ce(e.transform((e=>f(e)&&e.name===r?a:e)),t,n+1)}}return e}))}function ue(e,t={}){const n=ce("string"==typeof e?g(e):e,t),r=(h(n)?n.value:n).filter((e=>f(e)));return r.map((e=>{var t;return null!=(t=e.name)?t:""})).filter(((e,t,n)=>n.indexOf(e)===t))}function pe(e,t){return t.transform((t=>{if(v(t)){if(t.fn.name===e.name||"#dummy#"===e.name){const n=Object.fromEntries(e.params.map(((e,n)=>{var r;return[e,null!=(r=t.args[n])?r:new d(0)]})));return e.expr.transform((e=>f(e)&&e.name in n?n[e.name]:e))}return t}return t}))}[0,1,2].map((e=>new d(e)));const de=x(),fe={toSave:function(e){return JSON.stringify(e.map((e=>e.node.toString())))},fromSave:function(e){return re((()=>{const t=Object.entries(JSON.parse(e));let n=de;return t.forEach((([e,t])=>{if("string"!=typeof t)throw new Error("definition of "+e+" is not a string: "+String(t));[n]=le(ve(n,t)).value})),n}))},saveKey:"ExprEnv"};function ve(e,t){const n=function(e){return re((()=>g(e)))}(t);return o=t=>re((()=>{const n=Ee(t);if(e.has(n))throw new Error(n+" already defined");return[e.set(n,ge(n,t,S(ue(t)))),n]})),ne(r=n)?r:o(r.value);var r,o}let me=0;const ge=(e,t,n)=>({name:e,node:t,vars:n}),he=new y("x");function xe(e,t){return W(we(e,t))}function ye(e){return h(e)?e.value:e}function Se(e){return e.map((e=>ye(e.node))).toObject()}function we(e,t){const n=ye(t.node),r=Se(e),o=ce(n,r),a=S(function(e,t){return t.filter((t=>f(t)&&!Q(e,t.name))).map((e=>e.name))}(r,o));if(0===a.size)return o.toString();if(a.size>1)return;return ce(o,{[a.first()]:he}).toString()}function be(e=de,t,n="all"){const r=Ce(e,t.vars);return"all"===n?r:r.filter((t=>"bound"===n===e.has(t)))}function Ce(e,t,n=S()){if(t.some((e=>n.has(e))))throw new Error("Cyclic dependency: "+t.join(", "));const r=t.union(n);return r.union(t.flatMap((t=>{var n;const o=null==(n=e[t])?void 0:n.vars;return o?Ce(o,r):S()})))}const Ee=e=>h(e)||m(e)?e.name:"anon_"+me++;const ke=o({});function Oe(){return{...ke}}const _e={show:!1,color:"#ff00ff"};function Le(e){return null!=ke[e]||(ke[e]=_e),ke[e].color}function Ne(e){return null!=ke[e]||(ke[e]=_e),ke[e].show}const Re={toSave:function(e){return JSON.stringify(e)},fromSave:function(e){return re((()=>{const t=JSON.parse(e),n={};return Object.entries(t).forEach((([e,t])=>{if(!X(t,"show",Y)||!X(t,"color",w))throw new Error("invalid state for ExpressionUiState: "+String(t));n[e]=t})),n}))},saveKey:"ExpressionUiState"};let qe={};function je(){MathJax.typesetClear(),Promise.all(Object.values(qe)).then(MathJax.typesetPromise())}const Je={};function Ie(e,t,n,r){t?Je[e]={fn:r,color:n,graphType:"polyline"}:delete Je[e]}function Ue(e,t){const n=Object.values(Je);b({target:e,title:t,width:300,yAxis:{domain:[-1,9]},grid:!0,data:n,tip:{renderer:function(e,t,n){return t.toString()}}})}e("data-v-cf4a934c");const Be={class:"GraphExpr"},Ke={key:0},Me=["checked","value"],Te=["value"],ze=["id"],Pe=["onClick"];t();var $e=n({props:{expr:{type:null,required:!0},env:{type:null,required:!0}},emits:["new:expr","remove:expr"],setup(e,{emit:t}){const n=e;var r,o;function s(e){const t=n.expr.name,r=e.target.value;!function(e,t){null!=ke[e]||(ke[e]=_e),ke[e].color=t}(t,r),Ie(t,Ne(t),r,we(n.env,n.expr)),Ue("#graph","title here")}function d(e){const t=n.expr.name,r=e.target.checked;!function(e,t){null!=ke[e]||(ke[e]=_e),ke[e].show=t}(t,r),Ie(t,r,Le(t),we(n.env,n.expr)),Ue("#graph","title here")}return r="tex_"+n.expr.name,o=n.expr.node.toTex(),qe[r]=MathJax.tex2chtmlPromise(o,{em:64,ex:16,display:!1,scale:2}).then((e=>{const t=document.getElementById(r);t&&(t.innerHTML="",t.appendChild(e))})),C((()=>{const e=n.expr.name;Ie(e,Ne(e),Le(e),we(n.env,n.expr)),Ue("#graph","title here")})),E(je),C(je),(r,o)=>{return a(),l("div",Be,[i("button",{class:"closeButton",onClick:o[0]||(o[0]=e=>{t("remove:expr",n.expr.name)})},"x"),p(xe)(e.env,e.expr)?(a(),l("div",Ke,[i("input",{type:"checkbox",checked:p(Ne)(e.expr.name),value:p(Ne)(e.expr.name),onChange:d},null,40,Me),i("input",{type:"color",value:p(Le)(e.expr.name),onChange:s},null,40,Te),k(" "+u((f=e.expr,we(n.env,f))),1)])):c("",!0),i("span",{class:"tex",id:"tex_"+e.expr.name},u(e.expr.toString()),9,ze),(a(!0),l(O,null,_(p(be)(e.env,e.expr,"free"),(e=>(a(),l("div",null,[k(u(e)+" ",1),i("button",{onClick:r=>function(e){const r=ce(n.expr.node,Se(n.env));t("new:expr",L(N(r,e)).toString())}(e)},"dx",8,Pe)])))),256))]);var f}}});$e.__scopeId="data-v-cf4a934c";function Ae(e,t,n){return{...e,...{[n.saveKey]:n.toSave(t)}}}function De(e,t){return t.fromSave(e[t.saveKey])}function Ge(e,t){if(!X(e,t.saveKey,Z))throw new Error("save does not contain entry for "+t.saveKey);return e}const He={default:"default save"};function Ve(){return re((()=>{const e=window.localStorage.getItem("ig-calc-saves");if(!e)return Fe(He),He;return JSON.parse(e)}))}function Fe(e){window.localStorage.setItem("ig-calc-saves",JSON.stringify(e))}const We={class:"saveWidget"},Qe=["onClick"],Xe=["onClick"];var Ye=n({props:{env:{type:null,required:!0},expressionUiState:{type:null,required:!0}},emits:["restore","error"],setup(e,{emit:t}){const n=e,r=o(se(Ve(),(e=>t("error",e)),{}));function s(e,t){const o=R(((e,t)=>({saveName:e,saveDescription:t}))(e,t),q(Ae)(n.env,fe),q(Ae)(Oe(),Re));r[e]=t,Fe(r),function(e,t,n){Fe({...le(Ve()).value,[e]:t}),window.localStorage.setItem("ig-calc-saves/"+e,n)}(e,t,JSON.stringify(o))}function c(e){ie.on(function(e){return re((()=>{const t=window.localStorage.getItem("ig-calc-saves/"+e);if(!W(t))throw new Error("Save "+e+" not found");return t}))}(e),{Left:e=>{t("error",e)},Right:e=>{const n=JSON.parse(e),r=De(Ge(n,fe),fe);if(ne(r))return void t("error",r.value);const o=De(Ge(n,Re),Re);ne(o)?t("error",o.value):t("restore",{env:r.value,expressionUiState:o.value})}})}return(e,t)=>(a(),l("div",We,[(a(!0),l(O,null,_(p(r),((e,t)=>(a(),l("div",null,[k(u(t)+": "+u(e)+" ",1),i("button",{onClick:n=>s(t,e)},"save",8,Qe),i("button",{onClick:e=>c(t)},"load",8,Xe)])))),256))]))}});const Ze={class:"ig-calc"},et=i("div",{id:"graph"},null,-1),tt=k("> "),nt=i("br",null,null,-1),rt=["disabled"],ot={key:0,width:"100px"},at=i("br",null,null,-1),lt={key:0,color:"red"};var it=n({setup(e){const t=o({hideBottom:!1,hideLeft:!1,env:de,newExpr:"",parseResult:void 0,src:"x",error:void 0,info:""});function n(e){t.env=e.env,function(e){for(const t in e)ke[t]=e[t]}(e.expressionUiState)}return(e,r)=>(a(),l("div",Ze,[j(F,{"top-col-spec":"1fr","bottom-col-spec":"1fr",collapsed:p(t).hideBottom,"onUpdate:collapsed":r[5]||(r[5]=e=>p(t).hideBottom=e)},{top:J((()=>[j($,{"left-col-spec":"1fr","right-col-spec":"1fr",collapsed:p(t).hideLeft,"onUpdate:collapsed":r[2]||(r[2]=e=>p(t).hideLeft=e)},{left:J((()=>[(a(!0),l(O,null,_(p(t).env.values(),(e=>(a(),l("div",{key:e.name},[j($e,{env:p(t).env,expr:e,"onNew:expr":r[0]||(r[0]=e=>p(t).newExpr=e),"onRemove:expr":r[1]||(r[1]=e=>{return n=e,void(t.env=t.env.remove(n));var n})},null,8,["env","expr"])])))),128))])),right:J((()=>[et])),default:J((()=>[tt])),_:1},8,["collapsed"])])),bottom:J((()=>{var e;return[I(i("input",{type:"text",size:"80","onUpdate:modelValue":r[3]||(r[3]=e=>p(t).newExpr=e)},null,512),[[U,p(t).newExpr]]),nt,i("button",{disabled:""===p(t).newExpr,onClick:r[4]||(r[4]=e=>{return n=p(t).newExpr,void ae(ve(t.env,n),{Left:e=>{t.error=e.toString(),t.parseResult=void 0},Right:([e,n])=>{t.error=void 0,t.env=e,t.parseResult=e[n]}});var n})}," Validate ",8,rt),p(t).parseResult?(a(),l("div",ot,[k(" Name: "+u(null==(e=p(t).parseResult)?void 0:e.name)+" ",1),(a(!0),l(O,null,_(p(be)(p(t).env,p(t).parseResult),(e=>{var n,r,o;return a(),l("div",null,u(e)+": "+u(null!=(o=null==(r=null==(n=p(t).env.get(e))?void 0:n.node)?void 0:r.toString())?o:"#free"),1)})),256)),at])):c("",!0),i("div",null,[p(W)(p(t).error)?(a(),l("pre",lt,"        \r\n          "+u(p(t).error)+"\r\n        ",1)):c("",!0),j(Ye,{env:p(t).env,expressionUiState:p(Oe)(),onRestore:n},null,8,["env","expressionUiState"])])]})),_:1},8,["collapsed"])]))}}),st=n({setup:e=>(e,t)=>(a(),B(it))});window.global={},K(st).mount("#app");
